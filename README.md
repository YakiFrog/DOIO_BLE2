# DOIO KB16 USB-SSD1306 è¡¨ç¤ºã‚·ã‚¹ãƒ†ãƒ 

Seeed XIAO ESP32-S3ã®USBHostæ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦DOIO KB16ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®å…¥åŠ›ã‚’å–å¾—ã—ã€SSD1306 OLEDãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã«è¡¨ç¤ºã™ã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

## æ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€DOIO KB16ãƒžã‚¯ãƒ­ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ï¼ˆ4x4ãƒžãƒˆãƒªãƒƒã‚¯ã‚¹ï¼‰ã‚’Seeed XIAO ESP32-S3ã«æŽ¥ç¶šã—ã€ã‚­ãƒ¼å…¥åŠ›ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§SSD1306ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ï¼ˆ128x64ãƒ”ã‚¯ã‚»ãƒ«ï¼‰ã«è¡¨ç¤ºã—ã¾ã™ã€‚Pythonç‰ˆã®HIDãƒ¬ãƒãƒ¼ãƒˆã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ã‚’ãƒ™ãƒ¼ã‚¹ã«ã€é«˜æ€§èƒ½ãªC++å®Ÿè£…ã§æ§‹ç¯‰ã•ã‚Œã¦ã„ã¾ã™ã€‚KEYBOARD_BLEãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å®Ÿè£…ã‚’å‚è€ƒã«ã€USBHostæ©Ÿèƒ½ã‚’æœ€é©åŒ–ã—ã¦å®Ÿè£…ã—ã¾ã—ãŸã€‚

## æ©Ÿèƒ½è¦ä»¶

### 1. ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢è¦ä»¶

#### å¿…é ˆãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢
- **Seeed XIAO ESP32-S3**: USBHostæ©Ÿèƒ½æ­è¼‰ã€240MHzå‹•ä½œ
- **DOIO KB16**: 4x4ãƒžãƒˆãƒªãƒƒã‚¯ã‚¹ãƒžã‚¯ãƒ­ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰
  - VID: 0xD010 (53264)
  - PID: 0x1601 (5633)
  - 16ãƒã‚¤ãƒˆHIDãƒ¬ãƒãƒ¼ãƒˆå½¢å¼
  - 16ã‚­ãƒ¼ï¼ˆ4è¡ŒÃ—4åˆ—ãƒžãƒˆãƒªãƒƒã‚¯ã‚¹ï¼‰
- **SSD1306 OLED**: 128x64ãƒ”ã‚¯ã‚»ãƒ«ã€I2CæŽ¥ç¶šï¼ˆã‚¢ãƒ‰ãƒ¬ã‚¹: 0x3Cï¼‰
- **USB-Cã‚±ãƒ¼ãƒ–ãƒ«**: DOIO KB16ã¨XIAO ESP32-S3æŽ¥ç¶šç”¨

#### æŽ¥ç¶šæ§‹æˆ
```
DOIO KB16 â”€â”€USB-Câ”€â”€â†’ XIAO ESP32-S3 â”€â”€I2Câ”€â”€â†’ SSD1306
                         â”‚
                         â””â”€â”€ ã‚·ãƒªã‚¢ãƒ«å‡ºåŠ›ï¼ˆ115200bpsã€ãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
```

#### ãƒ”ãƒ³é…ç½®ï¼ˆXIAO ESP32-S3ï¼‰
```
D+/D- (USB Host): å†…è”µUSB OTGã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ä½¿ç”¨
SDA: GPIO5 (I2C ãƒ‡ãƒ¼ã‚¿ãƒ©ã‚¤ãƒ³) 
SCL: GPIO6 (I2C ã‚¯ãƒ­ãƒƒã‚¯ãƒ©ã‚¤ãƒ³)
3.3V: SSD1306é›»æºä¾›çµ¦
GND: å…±é€šã‚°ãƒ©ãƒ³ãƒ‰
```

### 2. ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢è¦ä»¶

#### é–‹ç™ºç’°å¢ƒ
- **PlatformIO**: ESP32é–‹ç™ºç’°å¢ƒï¼ˆæœ€æ–°ç‰ˆï¼‰
- **Arduino Framework**: espressif32 platform
- **Board**: seeed_xiao_esp32s3
- **Monitor Speed**: 115200bps
- **CPU Frequency**: 240MHzï¼ˆæœ€é«˜ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹è¨­å®šï¼‰

#### PlatformIOè¨­å®šï¼ˆplatformio.iniï¼‰
```ini
[env:seeed_xiao_esp32s3]
platform = espressif32
board = seeed_xiao_esp32s3
framework = arduino
monitor_speed = 115200
build_flags = 
    -DCORE_DEBUG_LEVEL=1
    -DCONFIG_ESP32S3_DEFAULT_CPU_FREQ_240=y
    -DCONFIG_FREERTOS_HZ=1000
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue
lib_deps = 
    adafruit/Adafruit GFX Library@^1.11.5
    adafruit/Adafruit BusIO@^1.14.1
    adafruit/Adafruit SSD1306@^2.5.7
```

### 3. æ©Ÿèƒ½ä»•æ§˜

#### 3.1 USB Hostæ©Ÿèƒ½
- **ãƒ‡ãƒã‚¤ã‚¹è‡ªå‹•æ¤œå‡º**: DOIO KB16ã®è‡ªå‹•èªè­˜ï¼ˆVID: 0xD010, PID: 0x1601ï¼‰
- **å¼·åˆ¶èªè­˜ãƒ¢ãƒ¼ãƒ‰**: VID/PIDãŒç•°ãªã‚‹å ´åˆã§ã‚‚å¼·åˆ¶çš„ã«DOIO KB16ã¨ã—ã¦å‡¦ç†
- **HIDãƒ¬ãƒãƒ¼ãƒˆå‡¦ç†**: 16ãƒã‚¤ãƒˆãƒ¬ãƒãƒ¼ãƒˆã®é«˜é€Ÿè§£æžï¼ˆ1mså¿œç­”æ€§ï¼‰
- **ã‚­ãƒ¼ãƒžãƒƒãƒ”ãƒ³ã‚°**: KEYBOARD_BLEãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã®å®Ÿè£…ç§»æ¤
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†**: è¶…ä½Žé…å»¶ã§ã®ã‚­ãƒ¼å…¥åŠ›æ¤œå‡ºï¼ˆUSBå‡¦ç†é–“éš”: 1msï¼‰

#### 3.2 HIDãƒ¬ãƒãƒ¼ãƒˆè§£æž
```cpp
// DOIO KB16 HIDãƒ¬ãƒãƒ¼ãƒˆæ§‹é€ ï¼ˆ16ãƒã‚¤ãƒˆï¼‰
// KEYBOARD_BLEãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è§£æžçµæžœã«åŸºã¥ã
struct KB16HIDReport {
    uint8_t modifier;      // ãƒã‚¤ãƒˆ0: ä¿®é£¾ã‚­ãƒ¼
    uint8_t reserved;      // ãƒã‚¤ãƒˆ1: äºˆç´„ï¼ˆDOIOå°‚ç”¨ï¼š0xAAæœŸå¾…å€¤ï¼‰
    uint8_t keycode[6];    // ãƒã‚¤ãƒˆ2-7: ã‚­ãƒ¼ã‚³ãƒ¼ãƒ‰ï¼ˆ6KROï¼‰
    uint8_t padding[8];    // ãƒã‚¤ãƒˆ8-15: ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°
};
```

#### 3.3 ã‚­ãƒ¼ãƒžãƒƒãƒ”ãƒ³ã‚°ä»•æ§˜ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
```cpp
// KEYBOARD_BLEãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ç§»æ¤ã•ã‚ŒãŸæ­£ç¢ºãªãƒžãƒƒãƒ”ãƒ³ã‚°
const KeyMapping kb16_key_map[] = {
    { 5, 0x20, 0, 0 },  // '1' (Row 0, Col 0)
    { 1, 0x01, 0, 1 },  // '2' (Row 0, Col 1)  
    { 1, 0x02, 0, 2 },  // '3' (Row 0, Col 2)
    { 5, 0x01, 0, 3 },  // '4' (Row 0, Col 3)
    { 4, 0x01, 1, 0 },  // '5' (Row 1, Col 0)
    { 5, 0x02, 1, 1 },  // '6' (Row 1, Col 1)
    { 4, 0x08, 1, 2 },  // '7' (Row 1, Col 2)
    { 4, 0x80, 1, 3 },  // '8' (Row 1, Col 3)
    { 4, 0x02, 2, 0 },  // '9' (Row 2, Col 0)
    { 4, 0x20, 2, 1 },  // '0' (Row 2, Col 1)
    { 5, 0x08, 2, 2 },  // Enter (Row 2, Col 2)
    { 4, 0x40, 2, 3 },  // Esc (Row 2, Col 3)
    { 4, 0x10, 3, 0 },  // Backspace (Row 3, Col 0)
    { 5, 0x10, 3, 1 },  // 'A' (Row 3, Col 1)
    { 4, 0x04, 3, 2 },  // Space (Row 3, Col 2)
    { 5, 0x04, 3, 3 },  // Tab (Row 3, Col 3)
};
```

#### 3.4 ç‰©ç†ã‚­ãƒ¼ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
```
ç‰©ç†ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆ4x4ãƒžãƒˆãƒªãƒƒã‚¯ã‚¹ï¼‰:
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚  1  â”‚  2  â”‚  3  â”‚  4  â”‚  ä¸Šæ®µï¼ˆRow 0ï¼‰
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚  5  â”‚  6  â”‚  7  â”‚  8  â”‚  Row 1
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚  9  â”‚  0  â”‚ Ent â”‚ Esc â”‚  Row 2
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ BS  â”‚  A  â”‚ Spc â”‚ Tab â”‚  ä¸‹æ®µï¼ˆRow 3ï¼‰
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
```

#### 3.5 SSD1306è¡¨ç¤ºæ©Ÿèƒ½
- **è§£åƒåº¦**: 128x64ãƒ”ã‚¯ã‚»ãƒ«
- **I2Cã‚¢ãƒ‰ãƒ¬ã‚¹**: 0x3C
- **ã‚¯ãƒ­ãƒƒã‚¯**: 100kHzï¼ˆé›»åŠ›åŠ¹çŽ‡é‡è¦–ï¼‰
- **è¡¨ç¤ºå†…å®¹**:
  - ãƒ‡ãƒã‚¤ã‚¹æŽ¥ç¶šçŠ¶æ…‹ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ï¼‰
  - æœ€å¾Œã«æŠ¼ã•ã‚ŒãŸã‚­ãƒ¼ã®ä½ç½®ï¼ˆè¡Œ,åˆ—ï¼‰
  - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚­ãƒ¼ãƒžãƒˆãƒªãƒƒã‚¯ã‚¹è¡¨ç¤ºï¼ˆ*: æŠ¼ä¸‹, .: æœªæŠ¼ä¸‹ï¼‰
  - ãƒ†ã‚­ã‚¹ãƒˆãƒãƒƒãƒ•ã‚¡ï¼ˆæœ€å¤§50æ–‡å­—ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¡¨ç¤ºï¼‰
- **ãƒ•ã‚©ãƒ³ãƒˆ**: å›ºå®šå¹…ãƒ•ã‚©ãƒ³ãƒˆï¼ˆ6x8ãƒ”ã‚¯ã‚»ãƒ«ï¼‰
- **æ›´æ–°é–“éš”**: ã‚­ãƒ¼å…¥åŠ›æ™‚ã¯å³åº§æ›´æ–°ã€é€šå¸¸æ™‚ã¯50msé–“éš”

#### 3.6 é•·æŠ¼ã—ãƒ»ãƒªãƒ”ãƒ¼ãƒˆæ©Ÿèƒ½
```cpp
// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æœ€é©åŒ–è¨­å®š
#define KEY_REPEAT_DELAY 200     // é•·æŠ¼ã—æ¤œå‡ºé…å»¶ï¼ˆmsï¼‰
#define KEY_REPEAT_RATE 30       // ãƒªãƒ”ãƒ¼ãƒˆé–“éš”ï¼ˆmsï¼‰- è¶…é«˜é€Ÿ
#define USB_TASK_INTERVAL 1      // USBå‡¦ç†é–“éš”ï¼ˆmsï¼‰- æœ€é«˜å¿œç­”æ€§
#define DISPLAY_UPDATE_INTERVAL 50   // ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤æ›´æ–°é–“éš”ï¼ˆmsï¼‰
```

### 4. è¡¨ç¤ºãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä»•æ§˜ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

#### 4.1 æŽ¥ç¶šå¾…æ©Ÿç”»é¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â† 128px
â”‚    USB Host Mode             â”‚ â† ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆy=0ï¼‰
â”‚     Activated                â”‚ â† ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆy=15ï¼‰
â”‚   Waiting for                â”‚ â† ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸1ï¼ˆy=30ï¼‰
â”‚   DOIO KB16...               â”‚ â† ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸2ï¼ˆy=40ï¼‰
â”‚ USB: Ready                   â”‚ â† ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆy=55ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.2 æŽ¥ç¶šå®Œäº†ç”»é¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     DOIO KB16                â”‚ â† ãƒ‡ãƒã‚¤ã‚¹åï¼ˆy=0ï¼‰
â”‚    Connected!                â”‚ â† æŽ¥ç¶šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆy=15ï¼‰
â”‚   Special Mode               â”‚ â† ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºï¼ˆy=30ï¼‰
â”‚ Keys: Ready                  â”‚ â† ã‚­ãƒ¼çŠ¶æ…‹ï¼ˆy=45ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.3 ã‚­ãƒ¼å…¥åŠ›ãƒ¢ãƒ‹ã‚¿ãƒ¼ç”»é¢ï¼ˆãƒ¡ã‚¤ãƒ³ç”»é¢ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DOIO KB16 Monitor            â”‚ â† ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆy=0ï¼‰
â”‚ Last: (2,1)                  â”‚ â† æœ€å¾Œã®ã‚­ãƒ¼ï¼ˆy=10ï¼‰
â”‚ Keys:                        â”‚ â† ãƒžãƒˆãƒªãƒƒã‚¯ã‚¹è¦‹å‡ºã—ï¼ˆy=20ï¼‰
â”‚ ....                         â”‚ â† Row 0ï¼ˆy=30ï¼‰
â”‚ .*..                         â”‚ â† Row 1ï¼ˆy=38ï¼‰
â”‚ ....                         â”‚ â† Row 2ï¼ˆy=46ï¼‰
â”‚ ....                         â”‚ â† Row 3ï¼ˆy=54ï¼‰
â”‚ Text:Hello                   â”‚ â† ãƒ†ã‚­ã‚¹ãƒˆãƒãƒƒãƒ•ã‚¡ï¼ˆy=56ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.4 è¡¨ç¤ºæ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯
```cpp
class DOIOKB16UsbHost {
    // è¡¨ç¤ºæ›´æ–°ãƒ•ãƒ©ã‚°ã‚·ã‚¹ãƒ†ãƒ 
    bool displayNeedsUpdate = false;  // ã‚­ãƒ¼å…¥åŠ›æ™‚ã®å³åº§æ›´æ–°
    
    // æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°
    void periodicDisplayUpdate() {
        if (displayNeedsUpdate) {
            updateKeyMatrixDisplay();  // å³åº§æ›´æ–°
            displayNeedsUpdate = false;
        } else if (connectionStateChanged) {
            updateConnectionDisplay();  // 1ç§’é–“éš”
        }
    }
};
```

### 5. ã‚·ã‚¹ãƒ†ãƒ å‹•ä½œãƒ•ãƒ­ãƒ¼ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

#### 5.1 åˆæœŸåŒ–ã‚·ãƒ¼ã‚±ãƒ³ã‚¹
```mermaid
flowchart TD
    A[ESP32-S3èµ·å‹•] --> B[CPU 240MHzè¨­å®š]
    B --> C[SSD1306åˆæœŸåŒ–]
    C --> D[æ›¸ãè¾¼ã¿ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºï¼š5ç§’]
    D --> E[USBHoståˆæœŸåŒ–]
    E --> F[DOIO KB16æ¤œå‡ºå¾…æ©Ÿ]
    F --> G{KB16æŽ¥ç¶š?}
    G -->|Yes| H[å¼·åˆ¶DOIO KB16ãƒ¢ãƒ¼ãƒ‰]
    G -->|No| I[æŽ¥ç¶šå¾…æ©Ÿè¡¨ç¤º]
    I --> F
    H --> J[HIDãƒ¬ãƒãƒ¼ãƒˆç›£è¦–é–‹å§‹]
    J --> K[ãƒ¡ã‚¤ãƒ³å‡¦ç†ãƒ«ãƒ¼ãƒ—]
```

#### 5.2 ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—å‡¦ç†ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
```cpp
void loop() {
    unsigned long now = millis();
    
    // USBå‡¦ç†ï¼ˆæœ€é«˜å¿œç­”æ€§ï¼š1msé–“éš”ï¼‰
    if ((now - lastUsbTask) >= 1) { 
        usbHost->task();
        lastUsbTask = now;
    }
    
    // é•·æŠ¼ã—å‡¦ç†ï¼ˆ5msé–“éš”ï¼‰
    if ((now - lastKeyRepeatCheck) >= 5) {
        usbHost->processKeyRepeat();
        lastKeyRepeatCheck = now;
    }
    
    // è¡¨ç¤ºæ›´æ–°ï¼ˆ5msé–“éš”ãƒã‚§ãƒƒã‚¯ã€å¿…è¦æ™‚å³åº§æ›´æ–°ï¼‰
    if ((now - lastDisplayCheck) >= 5) {
        usbHost->periodicDisplayUpdate();
        lastDisplayCheck = now;
    }
    
    delayMicroseconds(200); // 0.2ms - æœ€é«˜å¿œç­”æ€§
}
```

#### 5.3 ã‚­ãƒ¼å…¥åŠ›å‡¦ç†ãƒ•ãƒ­ãƒ¼
```mermaid
flowchart TD
    A[HIDãƒ¬ãƒãƒ¼ãƒˆå—ä¿¡] --> B[DOIO KB16åˆ¤å®š]
    B --> C[16ãƒã‚¤ãƒˆãƒ¬ãƒãƒ¼ãƒˆè§£æž]
    C --> D[ã‚­ãƒ¼ãƒžãƒƒãƒ”ãƒ³ã‚°å¤‰æ›]
    D --> E[çŠ¶æ…‹å¤‰åŒ–æ¤œå‡º]
    E --> F{ã‚­ãƒ¼å¤‰åŒ–ã‚ã‚Š?}
    F -->|Yes| G[ã‚­ãƒ¼ãƒžãƒˆãƒªãƒƒã‚¯ã‚¹æ›´æ–°]
    F -->|No| A
    G --> H[æ–‡å­—å‡¦ç†å®Ÿè¡Œ]
    H --> I[å³åº§ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤æ›´æ–°]
    I --> J[ã‚·ãƒªã‚¢ãƒ«å‡ºåŠ›]
    J --> A
```

### 6. å®Ÿè£…ã‚¯ãƒ©ã‚¹è¨­è¨ˆï¼ˆç¾åœ¨ã®å®Ÿè£…ï¼‰

#### 6.1 DOIOKB16UsbHostã‚¯ãƒ©ã‚¹
```cpp
class DOIOKB16UsbHost : public EspUsbHost {
private:
    // ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢åˆ¶å¾¡
    Adafruit_SSD1306* display;
    
    // ãƒ‡ãƒã‚¤ã‚¹çŠ¶æ…‹ç®¡ç†
    bool isDOIOKeyboard = false;
    bool isConnected = false;
    
    // ã‚­ãƒ¼ãƒžãƒˆãƒªãƒƒã‚¯ã‚¹ç®¡ç†ï¼ˆ4x4ï¼‰
    bool kb16_key_states[4][4];
    bool keyStateFast[4][4];      // é«˜é€Ÿå‡¦ç†ç”¨
    int lastPressedKeyRow = -1;
    int lastPressedKeyCol = -1;
    
    // é•·æŠ¼ã—ãƒ»ãƒªãƒ”ãƒ¼ãƒˆå‡¦ç†
    unsigned long keyPressTime[4][4];
    unsigned long lastRepeatTime[4][4];
    bool keyRepeating[4][4];
    
    // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æœ€é©åŒ–
    bool displayNeedsUpdate = false;
    volatile bool keyProcessingNeeded = false;
    String textBuffer;            // å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆãƒãƒƒãƒ•ã‚¡

public:
    // ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰
    void onNewDevice(const usb_device_info_t &dev_info) override;
    void onGone(const usb_host_client_event_msg_t *eventMsg) override;
    void onKeyboard(hid_keyboard_report_t report, hid_keyboard_report_t last_report) override;
    void processDOIOKB16Report(hid_keyboard_report_t report, hid_keyboard_report_t last_report);
    void processKeyPress(int row, int col);
    void processKeyRepeat();
    void updateKeyMatrixDisplay();
    void updateConnectionDisplay();
    void periodicDisplayUpdate();
};
```

#### 6.2 EspUsbHostã‚¯ãƒ©ã‚¹ï¼ˆã‚«ã‚¹ã‚¿ãƒ å®Ÿè£…ï¼‰
```cpp
class EspUsbHost {
protected:
    // USBãƒ›ã‚¹ãƒˆåˆ¶å¾¡
    usb_host_client_handle_t clientHandle;
    usb_device_handle_t deviceHandle;
    uint16_t device_vendor_id;
    uint16_t device_product_id;
    
    // DOIO KB16ç”¨æ‹¡å¼µ
    bool kb16_key_states[4][4];

public:
    virtual void onNewDevice(const usb_device_info_t &dev_info);
    virtual void onKeyboard(hid_keyboard_report_t report, hid_keyboard_report_t last_report);
    virtual void onReceive(const usb_transfer_t *transfer);
    void begin();
    void task();
};
```

### 7. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ä»•æ§˜ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

#### 7.1 å¿œç­”æ€§ã®æœ€é©åŒ–
```cpp
// è¶…é«˜é€Ÿè¨­å®šï¼ˆmain.cppå®Ÿè£…ï¼‰
#define USB_TASK_INTERVAL 1      // USBå‡¦ç†é–“éš”ï¼ˆ1msï¼‰
#define KEY_REPEAT_DELAY 200     // é•·æŠ¼ã—æ¤œå‡ºï¼ˆ200msï¼‰
#define KEY_REPEAT_RATE 30       // ãƒªãƒ”ãƒ¼ãƒˆé–“éš”ï¼ˆ30msï¼‰
#define DISPLAY_UPDATE_INTERVAL 50   // è¡¨ç¤ºæ›´æ–°é–“éš”ï¼ˆ50msï¼‰
```

#### 7.2 å®Ÿéš›ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æŒ‡æ¨™
- **ã‚­ãƒ¼å…¥åŠ›é…å»¶**: 1-3msï¼ˆå®Ÿæ¸¬å€¤ï¼‰
- **è¡¨ç¤ºæ›´æ–°**: ã‚­ãƒ¼å…¥åŠ›æ™‚å³åº§ã€é€šå¸¸æ™‚50msé–“éš”
- **USBå‡¦ç†å‘¨æœŸ**: 1msï¼ˆæœ€é«˜å¿œç­”æ€§ï¼‰
- **CPUå‘¨æ³¢æ•°**: 240MHzï¼ˆæœ€é«˜æ€§èƒ½è¨­å®šï¼‰
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: 
  - Available heap: ~300KBä»¥ä¸Š
  - Flashä½¿ç”¨é‡: ~1MBä»¥ä¸‹
  - SSD1306ãƒãƒƒãƒ•ã‚¡: 1KBï¼ˆ128x64/8bitï¼‰

#### 7.3 é›»åŠ›åŠ¹çŽ‡è¨­å®š
```cpp
// é›»åŠ›ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ã®ãƒãƒ©ãƒ³ã‚¹
Wire.setClock(100000);        // I2C 100kHzï¼ˆé›»åŠ›åŠ¹çŽ‡é‡è¦–ï¼‰
setCpuFrequencyMhz(240);      // CPUæœ€é«˜æ€§èƒ½
delayMicroseconds(200);       // æœ€å°å¾…æ©Ÿæ™‚é–“ï¼ˆ0.2msï¼‰
```

### 8. ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

#### 8.1 ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ãƒ‡ãƒãƒƒã‚°è¨­å®š
```cpp
// main.cppå†…ã®ãƒ‡ãƒãƒƒã‚°ãƒ•ãƒ©ã‚°
#define DEBUG_ENABLED 0      // åŸºæœ¬ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹é‡è¦–ã§ç„¡åŠ¹åŒ–ï¼‰
#define VERBOSE_DEBUG 0      // è©³ç´°ãƒ‡ãƒãƒƒã‚°ï¼ˆå¿…è¦æ™‚ã®ã¿æœ‰åŠ¹åŒ–ï¼‰

// platformio.iniã®ãƒ“ãƒ«ãƒ‰ãƒ•ãƒ©ã‚°
build_flags = 
    -DCORE_DEBUG_LEVEL=1     // ESP32ã‚³ã‚¢ãƒ‡ãƒãƒƒã‚°ãƒ¬ãƒ™ãƒ«
```

#### 8.2 ã‚·ãƒªã‚¢ãƒ«å‡ºåŠ›æ©Ÿèƒ½
```cpp
// ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±ï¼ˆDEBUG_ENABLED=1æ™‚ï¼‰
Serial.printf("VID: 0x%04X, PID: 0x%04X\n", device_vendor_id, device_product_id);
Serial.println("*** å¼·åˆ¶DOIO KB16ãƒ¢ãƒ¼ãƒ‰! ***");

// ã‚­ãƒ¼å…¥åŠ›ï¼ˆå¸¸æ™‚å‡ºåŠ›ï¼‰
Serial.printf("Key (%d,%d) PRESS/RELEASE\n", row, col);
Serial.print(keyChar);  // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ–‡å­—å‡ºåŠ›

// ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±
Serial.printf("CPU Frequency: %d MHz\n", getCpuFrequencyMhz());
Serial.printf("Available heap: %d bytes\n", ESP.getFreeHeap());
```

#### 8.3 è¡¨ç¤ºãƒ‡ãƒãƒƒã‚°
- **æŽ¥ç¶šçŠ¶æ…‹**: USBæŽ¥ç¶šçŠ¶æ³ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
- **ã‚­ãƒ¼ãƒžãƒˆãƒªãƒƒã‚¯ã‚¹**: 4x4ãƒžãƒˆãƒªãƒƒã‚¯ã‚¹ã®è¦–è¦šçš„çŠ¶æ…‹è¡¨ç¤ºï¼ˆ*: æŠ¼ä¸‹, .: æœªæŠ¼ä¸‹ï¼‰
- **æœ€çµ‚ã‚­ãƒ¼**: æœ€å¾Œã«æŠ¼ã•ã‚ŒãŸã‚­ãƒ¼ã®åº§æ¨™è¡¨ç¤º
- **ãƒ†ã‚­ã‚¹ãƒˆãƒãƒƒãƒ•ã‚¡**: å…¥åŠ›ã•ã‚ŒãŸæ–‡å­—åˆ—ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¡¨ç¤º

#### 8.4 HIDãƒ¬ãƒãƒ¼ãƒˆè§£æžï¼ˆVERBOSE_DEBUG=1æ™‚ï¼‰
```cpp
// Raw HIDãƒ‡ãƒ¼ã‚¿ã®16é€²è¡¨ç¤º
Serial.printf("DOIO KB16 Raw Data [%dãƒã‚¤ãƒˆ]: %s\n", 
              transfer->actual_num_bytes, hex_data.c_str());

// æ½œåœ¨çš„ã‚­ãƒ¼ã‚³ãƒ¼ãƒ‰æ¤œå‡º
if (possibleKeycode >= 0x04 && possibleKeycode <= 0xE7) {
    Serial.printf("æ½œåœ¨çš„ãªã‚­ãƒ¼ã‚³ãƒ¼ãƒ‰æ¤œå‡º: 0x%02X at position %d\n", 
                  possibleKeycode, i);
}
```

### 9. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

#### 9.1 USBãƒ‡ãƒã‚¤ã‚¹æŽ¥ç¶šã‚¨ãƒ©ãƒ¼å‡¦ç†
```cpp
// ãƒ‡ãƒã‚¤ã‚¹åˆ‡æ–­æ™‚ã®å‡¦ç†
void onGone(const usb_host_client_event_msg_t *eventMsg) override {
    Serial.println("ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãŒåˆ‡æ–­ã•ã‚Œã¾ã—ãŸ");
    isDOIOKeyboard = false;
    isConnected = false;
    
    // ã‚­ãƒ¼ãƒžãƒˆãƒªãƒƒã‚¯ã‚¹çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
    for (int i = 0; i < 4; i++) {
        for (int j = 0; j < 4; j++) {
            kb16_key_states[i][j] = false;
        }
    }
    displayNeedsUpdate = true;  // å³åº§ã«è¡¨ç¤ºæ›´æ–°
}
```

#### 9.2 SSD1306åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼å‡¦ç†
```cpp
void initDisplay() {
    if (!display.begin(SSD1306_SWITCHCAPVCC, SCREEN_ADDRESS)) {
        Serial.println("SSD1306 allocation failed - retrying...");
        
        // 3å›žã¾ã§ãƒªãƒˆãƒ©ã‚¤ï¼ˆé›»æºä¸å®‰å®šå¯¾ç­–ï¼‰
        delay(500);
        if (!display.begin(SSD1306_SWITCHCAPVCC, SCREEN_ADDRESS)) {
            delay(1000);
            if (!display.begin(SSD1306_SWITCHCAPVCC, SCREEN_ADDRESS)) {
                Serial.println("Display initialization failed - check power/connections");
                for(;;) delay(5000);  // ç„¡é™ãƒ«ãƒ¼ãƒ—ã§ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
            }
        }
    }
}
```

#### 9.3 å¼·åˆ¶èªè­˜ãƒ¢ãƒ¼ãƒ‰
```cpp
// VID/PIDãŒç•°ãªã‚‹å ´åˆã§ã‚‚DOIO KB16ã¨ã—ã¦å¼·åˆ¶å‡¦ç†
if (device_vendor_id == DOIO_VID && device_product_id == DOIO_PID) {
    isDOIOKeyboard = true;
    Serial.println("â˜… DOIO KB16ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’æ¤œå‡ºã—ã¾ã—ãŸï¼");
} else {
    // å¼·åˆ¶DOIO KB16ãƒ¢ãƒ¼ãƒ‰
    isDOIOKeyboard = true;
    isConnected = true;
    Serial.println("*** å¼·åˆ¶DOIO KB16ãƒ¢ãƒ¼ãƒ‰! ***");
}
```

### 10. è¨­å®šã¨ã‚«ã‚¹ã‚¿ãƒžã‚¤ã‚ºï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

#### 10.1 ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚è¨­å®šï¼ˆmain.cppï¼‰
```cpp
// ãƒ‡ãƒãƒƒã‚°è¨­å®š
#define DEBUG_ENABLED 0          // åŸºæœ¬ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›ï¼ˆ0=ç„¡åŠ¹, 1=æœ‰åŠ¹ï¼‰
#define VERBOSE_DEBUG 0          // è©³ç´°ãƒ‡ãƒãƒƒã‚°ï¼ˆ0=ç„¡åŠ¹, 1=æœ‰åŠ¹ï¼‰

// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹è¨­å®š
#define USB_TASK_INTERVAL 1      // USBå‡¦ç†é–“éš”ï¼ˆmsï¼‰
#define DISPLAY_UPDATE_INTERVAL 50   // ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤æ›´æ–°é–“éš”ï¼ˆmsï¼‰
#define KEY_REPEAT_DELAY 200     // é•·æŠ¼ã—æ¤œå‡ºé…å»¶ï¼ˆmsï¼‰
#define KEY_REPEAT_RATE 30       // é•·æŠ¼ã—æ™‚ã®ãƒªãƒ”ãƒ¼ãƒˆé–“éš”ï¼ˆmsï¼‰

// æ©Ÿèƒ½è¨­å®š
#define WRITE_MODE_DURATION 5000 // æ›¸ãè¾¼ã¿ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºæ™‚é–“ï¼ˆmsï¼‰
#define MAX_TEXT_LENGTH 50       // ãƒ†ã‚­ã‚¹ãƒˆãƒãƒƒãƒ•ã‚¡æœ€å¤§é•·
```

#### 10.2 ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢è¨­å®š
```cpp
// SSD1306ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤è¨­å®š
#define SCREEN_WIDTH 128         // æ¨ªè§£åƒåº¦
#define SCREEN_HEIGHT 64         // ç¸¦è§£åƒåº¦
#define OLED_RESET -1           // ãƒªã‚»ãƒƒãƒˆãƒ”ãƒ³ï¼ˆæœªä½¿ç”¨ï¼‰
#define SCREEN_ADDRESS 0x3C      // I2Cã‚¢ãƒ‰ãƒ¬ã‚¹

// DOIO KB16ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±
#define DOIO_VID 0xD010         // Vendor IDï¼ˆ53264ï¼‰
#define DOIO_PID 0x1601         // Product IDï¼ˆ5633ï¼‰
```

#### 10.3 å®Ÿè¡Œæ™‚è¨­å®š
```cpp
// CPUå‘¨æ³¢æ•°è¨­å®š
setCpuFrequencyMhz(240);        // æœ€é«˜æ€§èƒ½ï¼ˆ240MHzï¼‰

// I2Cé€šä¿¡è¨­å®š
Wire.setClock(100000);          // 100kHzï¼ˆé›»åŠ›åŠ¹çŽ‡é‡è¦–ï¼‰

// è¡¨ç¤ºè¨­å®š
display.setTextSize(1);         // ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º
display.setTextColor(SSD1306_WHITE);  // ç™½æ–‡å­—
```

### 11. ãƒ†ã‚¹ãƒˆè¦ä»¶ã¨å‹•ä½œç¢ºèª

#### 11.1 æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆï¼ˆå®Ÿè£…å®Œäº†ï¼‰
- [x] **SSD1306è¡¨ç¤ºæ©Ÿèƒ½**: 128x64è§£åƒåº¦ã€I2Cé€šä¿¡ï¼ˆ0x3Cï¼‰
- [x] **USBHoståˆæœŸåŒ–**: ESP32-S3 USB OTGæ©Ÿèƒ½
- [x] **HIDãƒ¬ãƒãƒ¼ãƒˆè§£æž**: 16ãƒã‚¤ãƒˆãƒ¬ãƒãƒ¼ãƒˆå‡¦ç†
- [x] **ã‚­ãƒ¼ãƒžãƒƒãƒ”ãƒ³ã‚°å¤‰æ›**: KEYBOARD_BLEãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ç§»æ¤æ¸ˆã¿
- [x] **ãƒ‡ãƒã‚¤ã‚¹è‡ªå‹•èªè­˜**: VID/PIDç…§åˆ + å¼·åˆ¶èªè­˜ãƒ¢ãƒ¼ãƒ‰

#### 11.2 çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆå®Ÿè£…å®Œäº†ï¼‰
- [x] **DOIO KB16æŽ¥ç¶šãƒ†ã‚¹ãƒˆ**: VID=0xD010, PID=0x1601å¯¾å¿œ
- [x] **å…¨ã‚­ãƒ¼å…¥åŠ›ãƒ†ã‚¹ãƒˆ**: 4x4ãƒžãƒˆãƒªãƒƒã‚¯ã‚¹ï¼ˆ16ã‚­ãƒ¼ï¼‰ã™ã¹ã¦å¯¾å¿œ
- [x] **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º**: ã‚­ãƒ¼å…¥åŠ›æ™‚ã®å³åº§è¡¨ç¤ºæ›´æ–°
- [x] **é•·æŠ¼ã—ãƒ»ãƒªãƒ”ãƒ¼ãƒˆæ©Ÿèƒ½**: 200msé…å»¶ã€30msãƒªãƒ”ãƒ¼ãƒˆé–“éš”
- [x] **ã‚¨ãƒ©ãƒ¼å›žå¾©ãƒ†ã‚¹ãƒˆ**: ãƒ‡ãƒã‚¤ã‚¹åˆ‡æ–­æ™‚ã®è‡ªå‹•å¾©æ—§

#### 11.3 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆå®Ÿæ¸¬å€¤ï¼‰
- [x] **ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“**: 1-3msï¼ˆUSBå‡¦ç†1msé–“éš”ï¼‰
- [x] **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: 300KBä»¥ä¸Šã®ç©ºããƒ’ãƒ¼ãƒ—ç¢ºä¿
- [x] **CPUè² è·**: 240MHzå‹•ä½œã€0.2msæœ€å°å¾…æ©Ÿ
- [x] **è¡¨ç¤ºæ›´æ–°**: ã‚­ãƒ¼å…¥åŠ›æ™‚å³åº§ã€é€šå¸¸æ™‚50msé–“éš”
- [x] **é•·æ™‚é–“å‹•ä½œ**: é€£ç¶šå‹•ä½œå¯¾å¿œã€ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯å¯¾ç­–æ¸ˆã¿

#### 11.4 å‹•ä½œç¢ºèªæ‰‹é †
```bash
# 1. PlatformIOã§ãƒ“ãƒ«ãƒ‰ãƒ»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
pio run --target upload --target monitor

# 2. ã‚·ãƒªã‚¢ãƒ«ãƒ¢ãƒ‹ã‚¿ãƒ¼ç¢ºèªé …ç›®
# - CPU Frequency: 240 MHz
# - Available heap: 300KBä»¥ä¸Š
# - USB Host initialized successfully!

# 3. è¡¨ç¤ºç¢ºèªé …ç›®
# - æ›¸ãè¾¼ã¿ãƒ¢ãƒ¼ãƒ‰ï¼ˆ5ç§’ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ï¼‰
# - USB Host Mode Activatedè¡¨ç¤º
# - DOIO KB16æŽ¥ç¶šæ™‚ã®ç”»é¢åˆ‡ã‚Šæ›¿ãˆ

# 4. ã‚­ãƒ¼å…¥åŠ›ãƒ†ã‚¹ãƒˆ
# - å„ã‚­ãƒ¼ã®åº§æ¨™è¡¨ç¤ºç¢ºèª
# - ãƒžãƒˆãƒªãƒƒã‚¯ã‚¹è¡¨ç¤ºã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
# - ãƒ†ã‚­ã‚¹ãƒˆãƒãƒƒãƒ•ã‚¡ã¸ã®æ–‡å­—å…¥åŠ›
```

### 12. å‚è€ƒè³‡æ–™ã¨é–¢é€£ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

#### 12.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–¢é€£
- **KEYBOARD_BLEãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: `/KEYBOARD_BLE/src/main.cpp` - ã‚­ãƒ¼ãƒžãƒƒãƒ”ãƒ³ã‚°å®Ÿè£…ã®å‚è€ƒå…ƒ
- **DOIO_Bluetoothãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: `/DOIO_Bluetooth/` - HIDãƒ¬ãƒãƒ¼ãƒˆè§£æžã®å‚è€ƒ
- **Pythonã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼PJT**: `/DOIO_BLE2/python/kb16_hid_report_analyzer.py` - ãƒ¬ãƒãƒ¼ãƒˆæ§‹é€ è§£æž

#### 12.2 æŠ€è¡“ä»•æ§˜
- **DOIO KB16ä»•æ§˜**: 
  - VID: 0xD010 (53264), PID: 0x1601 (5633)
  - 16ãƒã‚¤ãƒˆHIDãƒ¬ãƒãƒ¼ãƒˆå½¢å¼
  - 4x4ãƒžãƒˆãƒªãƒƒã‚¯ã‚¹ã€16ã‚­ãƒ¼æ§‹æˆ
- **ESP32-S3ä»•æ§˜**: 
  - USB OTG Hostæ©Ÿèƒ½
  - 240MHzå‹•ä½œã€PSRAMæ­è¼‰
  - Arduino Frameworkå¯¾å¿œ
- **SSD1306ä»•æ§˜**: 
  - 128x64ãƒ”ã‚¯ã‚»ãƒ«ã€I2Cé€šä¿¡ï¼ˆã‚¢ãƒ‰ãƒ¬ã‚¹: 0x3Cï¼‰
  - Adafruit SSD1306ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½¿ç”¨

#### 12.3 é–‹ç™ºç’°å¢ƒ
- **PlatformIO**: ESP32é–‹ç™ºç’°å¢ƒ
- **Board**: seeed_xiao_esp32s3
- **Framework**: Arduino
- **ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: Adafruit GFX, SSD1306, BusIO

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆï¼ˆç¾åœ¨ã®å®Ÿè£…ï¼‰

```
DOIO_BLE2/
â”œâ”€â”€ platformio.ini              # PlatformIOè¨­å®šï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
â”œâ”€â”€ README.md                   # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæ›´æ–°æ¸ˆã¿ï¼‰
â”œâ”€â”€ include/
â”‚   â”œâ”€â”€ EspUsbHost.h           # USBHoståŸºåº•ã‚¯ãƒ©ã‚¹ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
â”‚   â””â”€â”€ README                  # ç©ºãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.cpp               # ãƒ¡ã‚¤ãƒ³å‡¦ç†ï¼ˆå®Œå…¨å®Ÿè£…æ¸ˆã¿ï¼‰
â”‚   â””â”€â”€ EspUsbHost.cpp         # USBHostå®Ÿè£…ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ README                  # ç©ºãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ test/
â”‚   â””â”€â”€ README                  # ç©ºãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ python/                     # å‚è€ƒå®Ÿè£…ï¼ˆPythonã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ï¼‰
    â”œâ”€â”€ kb16_hid_report_analyzer.py  # HIDè§£æžãƒ„ãƒ¼ãƒ«
    â”œâ”€â”€ README.md               # Pythonç‰ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
    â”œâ”€â”€ bin/                    # Pythonä»®æƒ³ç’°å¢ƒ
    â”œâ”€â”€ include/                # Pythoné–¢é€£
    â”œâ”€â”€ lib/                    # Pythoné–¢é€£
    â””â”€â”€ kb16_analysis/          # è§£æžçµæžœä¿å­˜å…ˆ
```

## å®Ÿè£…çŠ¶æ³ã‚µãƒžãƒªãƒ¼

### âœ… å®Œå…¨å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½
- [x] **DOIO KB16 USBHostæŽ¥ç¶š**: VID/PIDè‡ªå‹•èªè­˜ + å¼·åˆ¶èªè­˜ãƒ¢ãƒ¼ãƒ‰
- [x] **SSD1306è¡¨ç¤ºåˆ¶å¾¡**: 128x64ãƒ”ã‚¯ã‚»ãƒ«ã€I2Cé€šä¿¡
- [x] **4x4ã‚­ãƒ¼ãƒžãƒˆãƒªãƒƒã‚¯ã‚¹**: 16ã‚­ãƒ¼å®Œå…¨å¯¾å¿œ
- [x] **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º**: ã‚­ãƒ¼å…¥åŠ›æ™‚å³åº§æ›´æ–°ï¼ˆ1-3mså¿œç­”æ€§ï¼‰
- [x] **é•·æŠ¼ã—ãƒ»ãƒªãƒ”ãƒ¼ãƒˆ**: 200msé…å»¶ã€30msãƒªãƒ”ãƒ¼ãƒˆé–“éš”
- [x] **ãƒ†ã‚­ã‚¹ãƒˆãƒãƒƒãƒ•ã‚¡**: 50æ–‡å­—ã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¡¨ç¤º
- [x] **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ãƒ‡ãƒã‚¤ã‚¹åˆ‡æ–­å¾©æ—§ã€è¡¨ç¤ºåˆæœŸåŒ–ãƒªãƒˆãƒ©ã‚¤
- [x] **ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½**: ã‚·ãƒªã‚¢ãƒ«å‡ºåŠ›ã€è¡¨ç¤ºãƒ‡ãƒãƒƒã‚°ã€HIDãƒ¬ãƒãƒ¼ãƒˆè§£æž
- [x] **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æœ€é©åŒ–**: 240MHzå‹•ä½œã€1ms USBå‡¦ç†é–“éš”

### ðŸ”§ ã‚«ã‚¹ã‚¿ãƒžã‚¤ã‚ºå¯èƒ½ãªè¨­å®š
- **ãƒ‡ãƒãƒƒã‚°ãƒ¬ãƒ™ãƒ«**: `DEBUG_ENABLED`, `VERBOSE_DEBUG`ãƒ•ãƒ©ã‚°
- **å¿œç­”æ€§èª¿æ•´**: USBå‡¦ç†é–“éš”ã€è¡¨ç¤ºæ›´æ–°é–“éš”ã€ã‚­ãƒ¼ãƒªãƒ”ãƒ¼ãƒˆè¨­å®š
- **è¡¨ç¤ºå†…å®¹**: ã‚­ãƒ¼ãƒžãƒƒãƒ”ãƒ³ã‚°ã€è¡¨ç¤ºãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
- **ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢è¨­å®š**: I2Cã‚¢ãƒ‰ãƒ¬ã‚¹ã€CPUå‘¨æ³¢æ•°

ã“ã®READMEã¯ã€å®Ÿè£…æ¸ˆã¿ã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã«åŸºã¥ã„ã¦æ­£ç¢ºãªä»•æ§˜ã‚’è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚DOIO KB16ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã¨Seeed XIAO ESP32-S3ã‚’ä½¿ç”¨ã—ãŸé«˜æ€§èƒ½ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ã®å®Œå…¨ãªæŠ€è¡“ä»•æ§˜æ›¸ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚
